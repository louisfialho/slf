<% if @shelf_mother.id == 20 %>
<!-- NAVBAR AND OPTIONS BOX IF USER ON SANDBOX SHELF -->
  <!-- Navbar: Back, space title, options -->
  <div class="navbar" id="navshow">
    <div>
      <% if @parent %>
        <%= link_to image_tag("left_arrow.png", width: 37).html_safe, space_path(@parent) %>
      <% else %>
        <%= link_to image_tag("left_arrow.png", width: 37).html_safe, shelf_path(@shelf_mother.username) %>
      <% end %>
    </div>
    <h1 class="space-title"> <%= @space.name %> </h1>
    <div id="options-btn">
      <a><%= image_tag "options.png", alt: "Options", width: 37 %></a>
    </div>
  </div>
  <!-- Options box: Add, move, destroy -->
  <div class="options-ctn options-ctn-shelf-space space-options" id="options" style="display:none;">
    <div class="option-ctn">
      <a >➕</a>
      <a class="option-label" id="new-object-or-space">New...</a>
    </div>
<!--     <div class="option-ctn">
      <a>👉</a>
      <a class="option-label" id="move-to">Move</a>
    </div>
    <div class="option-ctn">
      <a>🗑</a>
      <% parent = nil %>
      <% @space.connections.each do |connection| %>
        <% if connection.parent_id.nil? == false %>
          <% parent = connection.parent.space %>
        <% end %>
      <% end %>
      <% if @space.shelves.empty? == false %>
        <%= link_to 'Delete', space_path(@space, shelf_id: @space.shelves.first.id), method: :delete, class: "option-label" %>
      <% elsif parent.nil? == false %>
        <%= link_to 'Delete', space_path(@space, parent_id: parent.id), method: :delete, class: "option-label" %>
      <% end %>
    </div> -->
    <div class="option-ctn">
      <a>🏡</a>
      <a href="https://www.shelf.so/users/sign_up" class="option-label" id="new-object-or-space">Sign up</a>
    </div>
    <div class="option-ctn">
      <a>🚪</a>
      <%= link_to 'Leave', root_path, class: "option-label", id: "leave-shelf" %>
    </div>
  </div>

<!-- NAVBAR AND OPTIONS BOX IF USER SIGNED IN AND ON THEIR OWN SPACE -->
<% elsif user_signed_in? && (@current_user == @shelf_mother.user) %>
  <!-- Navbar: Back, space title, options -->
  <div class="navbar" id="navshow">
    <div>
      <% if @parent %>
        <%= link_to image_tag("left_arrow.png", width: 37).html_safe, space_path(@parent) %>
      <% else %>
        <%= link_to image_tag("left_arrow.png", width: 37).html_safe, shelf_path(@shelf_mother.username) %>
      <% end %>
    </div>
    <h1 class="space-title"> <%= @space.name %> </h1>
    <div id="options-btn">
      <a><%= image_tag "options.png", alt: "Options", width: 37 %></a>
    </div>
  </div>
  <!-- Options box: Add, move, destroy, leave -->
  <div class="options-ctn options-ctn-shelf-space space-options" id="options" style="display:none;">
    <div class="option-ctn">
      <a >➕</a>
      <a class="option-label" id="new-object-or-space">New...</a>
    </div>
    <div class="option-ctn">
      <a>👉</a>
      <a class="option-label" id="move-to">Move</a>
    </div>
    <% if @space.name != "🤖 Added by Bot" %>
      <div class="option-ctn">
        <a>🗑</a>
        <% parent = nil %>
        <% @space.connections.each do |connection| %>
          <% if connection.parent_id.nil? == false %>
            <% parent = connection.parent.space %>
          <% end %>
        <% end %>
        <% if @space.shelves.empty? == false %>
          <%= link_to 'Delete', space_path(@space, shelf_id: @space.shelves.first.id), method: :delete, class: "option-label" %>
        <% elsif parent.nil? == false %>
          <%= link_to 'Delete', space_path(@space, parent_id: parent.id), method: :delete, class: "option-label" %>
        <% end %>
      </div>
    <% end %>
    <div class="option-ctn" id="wallet-option">
      <a>👝</a>
      <%= link_to "Wallet", payment_path, class: "option-label", id: "wallet" %>
    </div>
    <div class="option-ctn">
      <a>🤖</a>
      <a class="option-label" id="connect-btn">Connect</a>
    </div>
    <div class="option-ctn">
      <a>🚪</a>
      <%= link_to 'Leave', destroy_user_session_path, method: :delete, class: "option-label", id: "leave-shelf" %>   <!-- si un utilisateur n'est pas logged in <%= link_to "Log in", new_user_session_path %> -->
    </div>
  </div>


<% elsif user_signed_in? && (@current_user != @shelf_mother.user) %>
<!-- NAVBAR AND OPTIONS BOX IF USER SIGNED IN AND NOT ON THEIR OWN SPACE -->
  <!-- Navbar: Back, space title, options -->
  <div class="navbar" id="navshow">
    <div>
      <% if @parent %>
        <%= link_to image_tag("left_arrow.png", width: 37).html_safe, space_path(@parent) %>
      <% else %>
        <%= link_to image_tag("left_arrow.png", width: 37).html_safe, shelf_path(@shelf_mother.username) %>
      <% end %>
    </div>
    <h1 class="space-title"> <%= @space.name %> </h1>
    <div id="options-btn">
      <a><%= image_tag "options.png", alt: "Options", width: 37 %></a>
    </div>
  </div>
  <!-- Options box: Back to my shelf -->
  <div class="options-ctn options-ctn-shelf-space space-options" id="options" style="display:none;">
    <div class="option-ctn">
      <a>🏠</a>
      <%= link_to 'Back to my shelf', shelf_path(@current_user.shelves.first.username), class: "option-label" %>
    </div>
  </div>

<% elsif user_signed_in? == false %>
<!-- NAVBAR AND OPTIONS BOX IF USER NOT SIGNED IN -->
  <!-- Navbar: Back, space title, login or sign up -->
  <div class="navbar" id="navshow">
    <div>
      <% if @parent %>
        <%= link_to image_tag("left_arrow.png", width: 37).html_safe, space_path(@parent) %>
      <% else %>
        <%= link_to image_tag("left_arrow.png", width: 37).html_safe, shelf_path(@shelf_mother.username) %>
      <% end %>
    </div>
    <h1 class="space-title"> <%= @space.name %> </h1>
    <div class="lp-login-signup-ctn">
      <%= link_to('Log in', new_user_session_path, class: 'login expand', id: 'login-lp', style: 'display:;') %>
      <%= link_to('Sign up', new_user_registration_path, class: 'lp-cta', id: 'signup-lp-btn', style: 'display:;') %>
      <%= link_to('Sign up', new_user_registration_path, class: 'login expand', id: 'signup-lp-simple', style: 'display:none') %>
    </div>
  </div>
  <!-- Options box: Not needed -->
<% end %>




<!-- MOVE TO LIST -->
  <div class="options-ctn" id="move-to-list" style="display:none;" data-type="space" data-space-id="<%= @space.id %>" data-shelf-id="<%= @shelf_mother.id %>">
    <div id="top-line">
      <%= image_tag("left_arrow.png", width: 23, height: 25, style: 'display:none;', id: 'left-arrow-img').html_safe %>
      <p class="option" id="top-element">Shelf</p>
    </div>
    <hr/>
    <ul id="children-spaces">
    <% move_space_to_space_list.each do |space| %>
      <% if space != @space %>
        <li>
          <a class="option" id="child-space-<%= space.id %>" data-space-id="<%= space.id %>">🗄 <%= truncate(space.name, length: 25) %></a>
        </li>
      <% end %>
    <% end %>
    </ul>
      <div id="button-new-space-parent">
        <%= image_tag("grey_plus.png", width: 18, height: 18, id: 'grey-plus-img').html_safe %>
        <div id="new-space-txt">New</div>
      </div>
    <%= button_to "👉 Move to shelf", { controller: "spaces", action: "move_space_to_shelf", current_space_id: @space.id }, id: 'move-to-button' %>
  <!--   <%= button_to "👉 Move to test", { controller: "spaces", action: "move_space_to_space", current_space_id: @space.id, destination_space_id: 1 }, id: 'move-to-button' %>
   -->
  </div>
<!-- END OF MOVE TO LIST -->

<!-- ADD OPTIONS -->
    <div class="options-ctn options-ctn-shelf-space" id="add-options" style="display:none;">
      <div class="option add-option" id="new-object">
      <% if policy(Item).create? %>
        <a>📚 New object</a>
      <% end %>
      </div>
      <div class="option add-option" id="button-new-space-child">
      <% if policy(Space).create? %>
        <a>🗄 New space</a>
      <% end %>
      </div>
    </div>
<!-- END OF ADD OPTIONS -->

<!-- ADD URL BOX -->
    <div class="options-ctn options-ctn-shelf-space" id="add-url" style="display:none;">
      <p class="option prompt" id="add-url-prompt"> Copy and paste the URL 🌐 for this new object </p>
      <%= form_for @item, remote: true do |f| %>
        <%= f.text_field :url, class: 'txt-inpt txt-inpt-box' %> <!-- autofocus: true, onblur: 'this.focus()' -->
        <%= f.hidden_field :space_id, :value => @space.id %> <!-- for controller -->
        <%= f.hidden_field :parent_id, :value => @space.id %> <!-- for pundit -->
        <%= f.submit "Add item", style: "display: none;" %>
      <% end %>
    </div>
<!-- END OF ADD URL BOX -->

<!-- ADD SPACE BOX -->
    <div class="options-ctn options-ctn-shelf-space" id="add-space" data-location="space" style="display:none;">
      <p class="option prompt" id="add-space-prompt" > What is the name of this new space? 🗄 </p>
      <%= simple_form_for @child, html: { autocomplete: 'off' } do |f| %>
        <%= f.text_field :name, class: 'txt-inpt txt-inpt-box' %>
        <%= f.hidden_field :shelf_id, :value => @shelf_mother.id %>
        <%= f.hidden_field :space_id, :value => @space.id %>
        <%= f.submit "Add space", style: "display: none;" %>
      <% end %>
    </div>
<!-- END OF ADD SPACE BOX -->

<!-- CONNECT OPTIONS -->
    <div class="options-ctn options-ctn-shelf-space" id="connect-options" style="display:none;">
      <div class="option-ctn" id="new-object">
        <a>💻</a>
        <a href="https://chrome.google.com/webstore/detail/shelf/dbnfpkfeedjlicclaffhoglpmgpdjblk?hl=en"  target="_blank" rel="noopener noreferrer" class="option-label">Chrome extension</a>
      </div>
      <% if @user %>
        <% if @user.telegram_chat_id.nil? %>
          <div class="option-ctn" id="button-new-space-child">
            <a>📱</a>
            <%= link_to 'Telegram Bot', meet_bot_path(@current_user), class: "option-label" %>
          </div>
        <% end %>
      <% end %>
    </div>
<!-- END OF CONNECT OPTIONS -->

<!-- IF SPACE IS EMPTY -->
<% if @space.children.empty? && @space.items.empty? %>
  <div class="center"><p class="msg">This space is empty.</p></div>
<% end %>
<div>
  <% if @shelf_mother.id == 20 %> <!-- the if and elsif conditions are litterally the same - could be refactored but kept as is for lisibiliy -->
    <div class="grid-container" data-controller="drag" data-drag-url="/:type/:id/move">
  <% elsif @current_user == @shelf_mother.user %>
    <div class="grid-container" data-controller="drag" data-drag-url="/:type/:id/move">
  <% else %>
    <div class="grid-container">
  <% end %>
    <% objects = @space.children.map { |connection| connection.space } + @space.items %> <!-- syntax à verif -->
    <% objects.sort_by(&:position).each do |object| %>
      <% if object.class.name == "Space" %>
        <% if policy(object).show? %>
          <div class="object" data-type="spaces" data-id="<%= object.id %>">
            <%= link_to image_tag("space.png", class: 'object-picture'), space_path(object) %>
  <!--           <%= link_to truncate(object.position.to_s + ' ' + object.name, length: 45), space_path(object),  class: "object_name" %> -->
            <%= link_to truncate(object.name, length: 45), space_path(object),  class: "object_name" %>
          </div>
        <% end %>
      <% elsif object.class.name == "Item" %>
        <% if policy(object).show? %>
          <div class="object" data-type="items" data-id="<%= object.id %>">
            <% if object.medium == "book" %>
              <%= link_to image_tag("book.png", class: 'object-picture'), item_path(object, space_id: @space.id) %>
            <% elsif object.medium == "podcast" %>
              <%= link_to image_tag("podcast.png", class: 'object-picture'), item_path(object, space_id: @space.id) %>
            <% elsif object.medium == "video" %>
              <%= link_to image_tag("video.png", class: 'object-picture'), item_path(object, space_id: @space.id) %>
            <% elsif object.medium == "blogpost" %>
              <%= link_to image_tag("blogpost.png", class: 'object-picture'), item_path(object, space_id: @space.id) %>
            <% elsif object.medium == "news_article" %>
              <%= link_to image_tag("news_article.png", class: 'object-picture'), item_path(object, space_id: @space.id) %>
            <% elsif object.medium == "academic_article" %>
              <%= link_to image_tag("academic_article.png", class: 'object-picture'), item_path(object, space_id: @space.id) %>
            <% elsif object.medium == "newsletter" %>
              <%= link_to image_tag("newsletter.png", class: 'object-picture'), item_path(object, space_id: @space.id) %>
            <% elsif object.medium == "tweet" %>
              <%= link_to image_tag("tweet.png", class: 'object-picture'), item_path(object, space_id: @space.id) %>
            <% elsif object.medium == "thread" %>
              <%= link_to image_tag("thread.png", class: 'object-picture'), item_path(object, shelf_id: @shelf.id) %>
            <% elsif object.medium == "audio_book" %>
              <%= link_to image_tag("audio_book.png", class: 'object-picture'), item_path(object, space_id: @space.id) %>
            <% elsif object.medium == "e_book" %>
              <%= link_to image_tag("e_book.png", class: 'object-picture'), item_path(object, space_id: @space.id) %>
            <% elsif object.medium == "online_course" %>
              <%= link_to image_tag("online_course.png", class: 'object-picture'), item_path(object, space_id: @space.id) %>
            <% elsif object.medium == "code_repository" %>
              <%= link_to image_tag("code_repository.png", class: 'object-picture'), item_path(object, space_id: @space.id) %>
            <% elsif object.medium == "blog" %>
              <%= link_to image_tag("blog.png", class: 'object-picture'), item_path(object, space_id: @space.id) %>
            <% else %>
              <%= link_to image_tag("blogpost.png", class: 'object-picture'), item_path(object, space_id: @space.id) %>
            <% end %>
  <!--           <%= link_to truncate(object.position.to_s + ' ' + object.name, length: 45), item_path(object, space_id: @space.id), class: "object_name" %> -->
              <%= link_to truncate(object.name, length: 40), item_path(object, space_id: @space.id), class: "object_name" %>
          </div>
        <% end %>
      <% end %>
    <% end %>
  </div>
</div>




