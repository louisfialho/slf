<!-- BEGINNING OF NAVBAR -->
<div class="navbar" id="navshow">
  <% if @shelf.id = 20 %>
    <%= link_to('shelf', root_path, class: 'logo') %>
    <div id="options-btn">
      <a><%= image_tag "options.png", alt: "Options", width: 37 %></a>
    </div>
  <% elsif user_signed_in? %>
    <% if @current_user == @shelf.user %>
      <p class="logo">shelf</p>
    <% else %>
      <div id="user-id-ctn">
        <%= image_tag "couch.png", alt: "Options", width: 37 %>
        <h1 class="user-id"> <%= @shelf.user.first_name %> <%= @shelf.user.last_name %>'s shelf </h1>
      </div>
    <% end %>
    <div id="options-btn">
      <a><%= image_tag "options.png", alt: "Options", width: 37 %></a>
    </div>
  <% else %>
      <div id="user-id-ctn">
        <%= image_tag "couch.png", alt: "Options", width: 37 %>
        <h1 class="user-id"> <%= @shelf.user.first_name %> <%= @shelf.user.last_name %>'s shelf </h1>
      </div>
      <%= link_to('Login', new_user_session_path, class: 'login expand') %>
  <% end %>
</div>
<!-- END OF NAVBAR -->

<!-- OPTIONS SPACE -->
  <% if @shelf.id = 20 %>
    <div class="options-ctn options-ctn-shelf-space shelf-options" id="options" style="display:none;">
      <div class="option-ctn">
        <a>â•</a>
        <a class="option-label" id="new-object-or-space">New...</a>
      </div>
    </div>
  <% elsif user_signed_in? %>
    <div class="options-ctn options-ctn-shelf-space shelf-options" id="options" style="display:none;">
      <% if @current_user == @shelf.user %>
        <div class="option-ctn">
          <a>â•</a>
          <a class="option-label" id="new-object-or-space">New...</a>
        </div>
        <div class="option-ctn">
          <a>ğŸšª</a>
          <%= link_to 'Leave', destroy_user_session_path, method: :delete, class: "option-label", id: "leave-shelf" %>   <!-- si un utilisateur n'est pas logged in <%= link_to "Log in", new_user_session_path %> -->
        </div>
      <% else %>
        <div class="option-ctn">
          <a>ğŸ </a>
          <%= link_to 'Back to my shelf', shelf_path(@current_user.shelves.first), class: "option-label" %>
        </div>
      <% end %>
    </div>
  <% end %>
<!-- END OF OPTIONS SPACE -->


<!-- OPTIONS -->
    <div class="options-ctn options-ctn-shelf-space" id="add-options" style="display:none;">
      <div class="option add-option" id="new-object">
        <a>ğŸ“š New object</a>
      </div>
      <div class="option add-option" id="button-new-space-child">
        <a>ğŸ—„ New space</a>
      </div>
    </div>
<!-- END OF OPTIONS -->

<!-- ADD URL BOX -->
    <div class="options-ctn options-ctn-shelf-space" id="add-url" style="display:none;">
      <p class="option prompt" id="add-url-prompt" > Copy and paste a URL ğŸŒ to create a new object </p>
      <%= form_for @item, remote: true do |f| %>
        <%= f.text_field :url, class: 'txt-inpt txt-inpt-box' %> <!-- autofocus: true, onblur: 'this.focus()' --> <!-- onpaste: 'setTimeout(function(){ form.submit(); }, 0.1); -->
        <%= f.hidden_field :shelf_id, :value => @shelf.id %>
        <%= f.submit "Add item", style: "display: none;" %>
      <% end %>
    </div>
<!-- END OF ADD URL BOX -->

<!-- ADD SPACE NAME BOX -->
    <div class="options-ctn options-ctn-shelf-space" id="add-space" data-location="shelf" style="display:none;">
      <p class="option prompt" id="add-space-prompt" > What is the name of this new space? ğŸ—„ </p>
      <%= simple_form_for @space, html: { autocomplete: 'off' } do |f| %>
        <%= f.text_field :name, class: 'txt-inpt txt-inpt-box' %> <!-- autofocus: true, onblur: 'this.focus()' --> <!-- onpaste: 'setTimeout(function(){ form.submit(); }, 0.1); -->
        <%= f.hidden_field :shelf_id, :value => @shelf.id %>
        <%= f.submit "Add space", style: "display: none;" %>
      <% end %>
    </div>
<!-- END OF ADD SPACE NAME BOX -->

<!-- IF SHELF IS EMPTY -->
<% if @shelf.spaces.empty? && @shelf.items.empty? %>
  <div class="center"><p class="msg">Your shelf is empty.</p></div>
<% end %>


<!-- IF SHELF HAS OBJECTS -->
<div>
  <% if @shelf.id = 20 %> <!-- the if and elsif conditions are litterally the same - could be refactored but kept as is for lisibiliy -->
    <div class="grid-container" data-controller="drag" data-drag-url="/:type/:id/move">
  <% elsif @current_user == @shelf.user %>
    <div class="grid-container" data-controller="drag" data-drag-url="/:type/:id/move">
  <% else %>
    <div class="grid-container">
  <% end %>
    <% objects = @shelf.spaces + @shelf.items %>
    <% objects.sort_by(&:position).each do |object| %>
      <% if object.class.name == "Space" %>
        <% if policy(object).show? %>
          <div class="object" data-type="spaces" data-id="<%= object.id %>">
            <%= link_to image_tag("space.png", class: 'object-picture'), space_path(object, shelf_id: @shelf.id) %>
  <!--           <%= link_to truncate(object.position.to_s + ' ' + object.name.split.map(&:capitalize).join(' '), length: 45), space_path(object, shelf_id: @shelf.id), class: "object_name" %> -->
            <%= link_to truncate(object.name.split.map(&:capitalize).join(' '), length: 45), space_path(object, shelf_id: @shelf.id), class: "object_name" %>
          </div>
        <% end %>
      <% elsif object.class.name == "Item" %>
        <% if policy(object).show? %>
          <div class="object" data-type="items" data-id="<%= object.id %>">
            <% if object.medium == "book" %>
              <%= link_to image_tag("book.png", class: 'object-picture'), item_path(object, shelf_id: @shelf.id) %>
            <% elsif object.medium == "podcast" %>
              <%= link_to image_tag("podcast.png", class: 'object-picture'), item_path(object, shelf_id: @shelf.id) %>
            <% elsif object.medium == "video" %>
              <%= link_to image_tag("video.png", class: 'object-picture'), item_path(object, shelf_id: @shelf.id) %>
            <% else object.medium == "web" %>
              <%= link_to image_tag("web.png", class: 'object-picture'), item_path(object, shelf_id: @shelf.id) %>
            <% end %>
  <!--           <%= link_to truncate(object.position.to_s + ' ' + object.name, length: 40), item_path(object, shelf_id: @shelf.id), class: "object_name" %> -->
            <%= link_to truncate(object.name, length: 40), item_path(object, shelf_id: @shelf.id), class: "object_name" %>
          </div>
        <% end %>
      <% end %>
    <% end %>
  </div>
</div>
